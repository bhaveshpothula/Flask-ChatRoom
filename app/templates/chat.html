<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Chat Room: {{ room }}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="//code.jquery.com/jquery-1.4.2.min.js"></script>
  <script src="//cdn.socket.io/4.4.1/socket.io.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: "Poppins", sans-serif;
      height: 100vh;
      display: flex;
      flex-direction: column;
      background: linear-gradient(135deg, #667eea, #764ba2, #6d83f2);
      background-size: 400% 400%;
      animation: gradientShift 12s ease infinite;
      color: #fff;
    }

    @keyframes gradientShift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    /* Header bar */
    .header {
      backdrop-filter: blur(10px);
      background: rgba(255, 255, 255, 0.1);
      padding: 1rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-weight: 600;
      box-shadow: 0 2px 10px rgba(0,0,0,0.15);
    }

    .leave-btn {
      background: rgba(255, 255, 255, 0.25);
      border: none;
      color: #fff;
      padding: 0.5rem 1rem;
      border-radius: 0.5rem;
      cursor: pointer;
      transition: 0.2s;
    }
    .leave-btn:hover {
      background: rgba(255, 255, 255, 0.4);
    }

    /* Chat area takes the rest of the screen */
    .chat-area {
      flex: 1;
      display: flex;
      flex-direction: column;
      padding: 1rem 2rem;
      overflow: hidden;
    }

    /* Chat log box */
    #chat {
      flex: 1;
      width: 100%;
      resize: none;
      border: none;
      border-radius: 1rem;
      padding: 1rem;
      font-size: 1rem;
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(10px);
      color: #fff;
      overflow-y: auto;
      margin-bottom: 1rem;
      line-height: 1.5;
      white-space: pre-wrap;
    }

    /* Input area at bottom */
    .input-area {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    #text {
      flex: 1;
      border: none;
      border-radius: 0.7rem;
      padding: 0.9rem 1.2rem;
      font-size: 1rem;
      color: #fff;
      background: rgba(255, 255, 255, 0.2);
      backdrop-filter: blur(8px);
      outline: none;
      transition: 0.2s;
    }

    #text::placeholder {
      color: #eee;
    }

    #text:focus {
      background: rgba(255, 255, 255, 0.3);
    }

    ::-webkit-scrollbar {
      width: 6px;
    }
    ::-webkit-scrollbar-thumb {
      background: rgba(255,255,255,0.3);
      border-radius: 3px;
    }

    /* Responsive */
    @media (max-width: 600px) {
      .header, .chat-area {
        padding: 1rem;
      }
      #chat {
        font-size: 0.9rem;
      }
    }
  </style>

  <script type="text/javascript" charset="utf-8">
    let socket;
    $(document).ready(function(){
      socket = io.connect('http://' + document.domain + ':' + location.port + '/chat');
      socket.on('connect', function() {
        socket.emit('joined', {});
      });
      socket.on('status', function(data) {
        const d = new Date();
        $('#chat').append(`[${d.toLocaleTimeString()}] <${data.msg}>\n`);
        $('#chat').scrollTop($('#chat')[0].scrollHeight);
      });
      socket.on('message', function(data) {
        const d = new Date();
        $('#chat').append(`[${d.toLocaleTimeString()}] ${data.msg}\n`);
        $('#chat').scrollTop($('#chat')[0].scrollHeight);
      });
      $('#text').keypress(function(e) {
        if (e.which === 13) {
          const text = $('#text').val();
          $('#text').val('');
          socket.emit('text', {msg: text});
        }
      });
    });

    function leave_room() {
      socket.emit('left', {}, function() {
        socket.disconnect();
        window.location.href = "{{ url_for('main.index') }}";
      });
    }
  </script>
</head>
<body>
  <div class="header">
    <span>ðŸ’¬ Room: {{ room }}</span>
    <button class="leave-btn" onclick="leave_room()">Leave</button>
  </div>

  <div class="chat-area">
    <textarea id="chat" readonly></textarea>
    <div class="input-area">
      <input id="text" type="text" placeholder="Type your message and press Enter...">
    </div>
  </div>
</body>
</html>

